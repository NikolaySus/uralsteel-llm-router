# Авторизация в gRPC LLM Router

## Обзор

Сервис имеет публичные и защищённые методы:
- **Ping** - публичный метод (без авторизации) для health-check
- **NewMessage, AvailableModelsText2Text, AvailableModelsSpeech2Text** - защищённые методы (требуют SECRET_KEY)

## Архитектура авторизации

### Принцип: Interceptor на уровне gRPC

Авторизация реализована через **gRPC ServerInterceptor** - это middleware, которое работает **ДО** вызова бизнес-логики метода.

```
┌─────────────────────────────────────────────────────────────┐
│                    gRPC Request                             │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
        ┌────────────────────────────┐
        │   AuthInterceptor          │◄── Проверка на уровне сети!
        │   - Читает metadata        │
        │   - Проверяет SECRET_KEY   │
        │   - Отклоняет быстро!      │
        └────────┬───────────────────┘
                 │
        ┌────────▼──────────┐
        │ Is Public Method? │
        └────────┬──────────┘
                 │
       ┌─────────┴─────────┐
       │                   │
     [YES]               [NO]
       │                   │
       ▼                   ▼
   Continue           Check Token
       │                   │
       │            ┌──────▼───────┐
       │            │ Valid Token? │
       │            └──────┬───────┘
       │                   │
       │          ┌────────┴────────┐
       │          │                 │
       │        [YES]             [NO]
       │          │                 │
       │          ▼                 ▼
       │      Continue            Abort
       │          │           UNAUTHENTICATED
       │          │
       └─────┬────┘
             │
             ▼
   ┌────────────────────┐
   │  Servicer Method   │
   │  (NewMessage, etc) │
   └────────────────────┘
```

## Преимущества использования Interceptor

| Аспект | Преимущество |
|--------|---------|
| **Производительность** | Неавторизованные запросы отклоняются **ДО вызова** бизнес-логики |
| **Безопасность** | Проверка на уровне сетевого протокола |
| **Чистота кода** | Нет дублирования проверок в каждом методе |
| **Масштабируемость** | Легко добавлять новые защищённые методы |
